(()=>{"use strict";var t={d:(e,s)=>{for(var n in s)t.o(s,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:s[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{changes:()=>S,compute:()=>B,init:()=>D,resetChanges:()=>T});class s extends class{constructor(){this.memory=new Map}get(t,e){return this.memory.get(t)?.get(e)}set(t,e,s){const{memory:n}=this;n.has(t)||n.set(t,new Map),n.get(t).set(e,s)}rows(){return Array.from(this.memory.keys())}cols(t){return Array.from(this.memory.get(t)?.keys()||[])}del(t,e){this.memory.get(t)?.delete(e)}}{constructor(){super(),this.changes=[]}get(t,e){return this.memory.get(t)?.get(e)}set(t,e,s){const{memory:n,changes:o}=this;n.has(t)||n.set(t,new Map),n.get(t).set(e,s),o.push({row:t,col:e,value:s})}rows(){return Array.from(this.memory.keys())}cols(t){return Array.from(this.memory.get(t)?.keys()||[])}del(t,e){this.memory.get(t)?.delete(e)}reset(){this.changes=[]}}const n=Math.PI/180;function o(t){return Math.cos(t*n)}function r(t){return Math.sin(t*n)}async function a(t=0){return new Promise((e=>setTimeout(e,t)))}function i(t,e){return Math.floor(Math.random()*(e-t+1)+t)}const c=document.getElementById("map-background-layer").getContext("2d");c.imageSmoothingEnabled=!1;const h=document.getElementById("map-main-layer").getContext("2d");h.imageSmoothingEnabled=!1;const l=document.getElementById("player-main-layer").getContext("2d");l.imageSmoothingEnabled=!1;const y=document.getElementById("player-path-layer").getContext("2d");y.imageSmoothingEnabled=!1;const d={w:!1,a:!1,s:!1,d:!1};document.addEventListener("keydown",(({key:t})=>{switch(t){case"w":d.w=!0;break;case"a":d.a=!0;break;case"s":d.s=!0;break;case"d":d.d=!0}})),document.addEventListener("keyup",(({key:t})=>{switch(t){case"w":d.w=!1;break;case"a":d.a=!1;break;case"s":d.s=!1;break;case"d":d.d=!1}}));class u{constructor(t=250,e=250,s=30,n=0){this.x=t+s,this.y=e+s,this.rx=t,this.ry=e,this.dir=n,this.length=s}update(){this.dir++,this.dir>=360&&(this.dir=0);const{dir:t}=this,e=this.length;return this.x=this.rx+Math.round(e*o(t)-0*r(t)),this.y=this.ry+Math.round(e*r(t)+0*o(t)),{x:this.x,y:this.y}}}const g=Object.assign([],{update(){for(let t=0,e=g.length;t<e;t++)g[t].update()}});for(let t=30;t<50;t++)g.push(new u(250,250,t));const m=new Image;m.src="assets/maze.png";const f=m.width,x=m.height,p={x:100,y:100},w=Object.assign(new Array(x).fill(0).map((()=>new Array(f).fill(0))),{data:[],dir:0,reset:function(){const{data:t}=this;for(let e=0,s=x;e<s;e++)for(let s=0,n=f;s<n;s++)w[e][s]=+!t[e*f+s];for(let t=0,e=g.length;t<e;t++){const{x:e,y:s}=g[t];w[s][e]=1}w[250][250]=100},set(t){this.data=Array.from(t.filter(((t,e)=>e%4==0)))}}),M=w;class b{constructor(t,e=100){this.integrals=[],this.dir=t;const s=e;this.dx=Math.round(s*o(t)-0*r(t)),this.dy=Math.round(s*r(t)+0*o(t))}update(t,e){const[s,n,o]=function(t,e,s,n){const o=Math.abs(s-t),r=Math.abs(n-e),a=t<s?1:-1,i=e<n?1:-1;let c=o-r;const h=[];for(;;){const l=M[e]?.[t];if(100===l)return[h,void 0,{x:t,y:e}];if(void 0===l||1===l)return[h,{x:t,y:e},void 0];if(t===s&&e===n)return[h,void 0];h.push({x:t,y:e});const y=2*c;y>-r&&(c-=r,t+=a),y<o&&(c+=o,e+=i)}}(t,e,t+this.dx,e+this.dy);return this.integrals=s,[0===s.length,n,o]}}const{sqrt:k}=Math;let I,v,P,E;function D(t,e){v=[],I=e,P=t.memory,E=new s;const{x:n,y:o}=t,r=C({x:n,y:o},I);v.push({x:n,y:o,ds:0,dg:r,cost:r})}function S(){return E.changes}function T(){E.reset()}function B(){v.sort(F);const t=v.pop(),{x:e,y:s,ds:n}=t;E.set(s,e,1);for(let o=s+2;--o>=s-1;)for(let s=e+2;--s>=e-1;){const e={x:s,y:o,parent:t},r=P.get(o,s);if(s===I.x&&o===I.y)return A(e,[]);if(2===r||1===E.get(o,s))continue;const a=.95*n+C(e,t),i=C(e,I),c=a+i,h=O(e);h?h.cost>c&&(h.cost=c,h.ds=a,h.dg=i,h.parent=t):v.push({...e,cost:c,ds:a,dg:i})}}function C(t,e){const s=t.x-e.x,n=t.y-e.y;return k(s*s+n*n)}function F(t,e){return e.cost-t.cost||e.dg-t.dg}function A(t,e){e.push(t);const{parent:s}=t;return s?A(s,e):e}function O(t){const{x:e,y:s}=t;for(let t=v.length;--t>=0;){const n=v[t];if(e===n.x&&s===n.y)return n}}const j=l.createImageData(f+2,x+2);let $=y.createImageData(f+2,x+2);const L=4*(f+2);function G(){const t=p.y+1,e=p.x+1,{data:s}=$,n=S();for(let o=0,r=n.length;o<r;o++){const{row:r,col:a,value:i}=n[o],c=(r+t)*L+4*(a+e);switch(i){case 1:s[c]=255;break;case 2:s[c+1]=255}s[c+3]=255}y.putImageData($,0,0),T()}const R=new class{constructor(t=0,n=0,o=360){this.memory=new s,this.dir=0,this.rays=[],this.path=[],this.goalDirections=[],this.x=t,this.y=n,this.pathfinder=e;for(let t=0;t<360;t+=360/o)this.rays.push(new b(t,50))}findGoal(t,e){if(this.goalDirections.length>10){const t=100,e=0;for(const{x:s,y:n,dir:a}of this.goalDirections){const i=s+Math.round(t*o(a)-e*r(a)),c=n+Math.round(t*r(a)+e*o(a))-n,h=s-i,l=c*s+h*n;for(const{x:s,y:n,dir:a}of this.goalDirections){const i=s+Math.round(t*o(a)-e*r(a)),y=n+Math.round(t*r(a)+e*o(a))-n,d=s-i,u=y*s+d*n,g=c*d-y*h;if(0!==g)return void(this.goal={x:Math.round((d*l-h*u)/g),y:Math.round((c*u-y*l)/g)})}}}const{x:s,y:n,dir:a}=this;this.goalDirections.push({x:s+t,y:n+e,dir:a}),this.path.push({x:s+i(-1,1),y:n+i(-1,1)})}async update(t,e){this.dir=function(t,e,s,n){const o=t-250,r=e-250,a=180*Math.atan2(-r,-o)/Math.PI;return a<0?a+360:a}(this.x+t,this.y+e),this.x+t===this.goal?.x&&this.y+e===this.goal?.y&&(this.goal=void 0,this.goalDirections=[]),this.goal||this.findGoal(t,e),this.goal&&0===this.path.length&&await this.computePath(t,e);const{x:s,y:n}=this.path.pop(),a=[],{rays:i,memory:c}=this;for(let h=0,l=i.length;h<l;h++){const l=i[h],[y,d,u]=l.update(s+t,n+e);if(u&&(this.goal=u,c.set(u.y-e,u.x-t,3)),y){const{dir:s}=l,n=Math.round(o(s)-r(s)),a=Math.round(r(s)+o(s));return this.path=[{x:this.x-3*n,y:this.y-3*a}],this.update(t,e)}d&&a.push(d)}c.reset();for(let s=0,n=a.length;s<n;s++){const{x:n,y:o}=a[s];2!==c.get(o-e,n-t)&&c.set(o-e,n-t,2)}for(let s=0,n=i.length;s<n;s++){const{integrals:n}=i[s];for(let s=0,o=n.length;s<o;s++){const{x:o,y:r}=n[s];1!==c.get(r-e,o-t)&&c.set(r-e,o-t,1)}}this.x=s,this.y=n}async computePath(t,e){const{path:s,goal:n,pathfinder:o}=this;if(0===s.length&&n){let s;for(o.init(this,{x:n.x-t,y:n.y-e}),$=y.createImageData(f+2,x+2);!s;)s=o.compute(),G(),await a();this.path=s}}},_=new class{constructor(){this.time=0,this.start()}start(){this.time=performance.now()}end(){return performance.now()-this.time}},q=document.getElementById("fps"),z=document.getElementById("player-pos"),H=document.getElementById("player-actual-pos"),J=document.getElementById("player-estimate");let K=0;async function N(){_.start(),g.update(),M.reset(),await R.update(p.x,p.y),Q(N)}function Q(t){!function(){h.clearRect(0,0,f,x),h.strokeStyle="#CDCDCD";const{rays:t,dir:e}=R;for(let e=0,s=t.length;e<s;e++){const s=t[e].integrals;s[0]&&(h.beginPath(),h.moveTo(s[0].x,s[0].y),h.lineTo(s[s.length-1].x,s[s.length-1].y),h.stroke())}h.fillStyle="#000000",g.forEach((({x:t,y:e})=>{h.fillRect(t,e,1,1),h.fill()}));const s=R.x+p.x,n=R.y+p.y;h.fillStyle="#FF0000",h.beginPath(),h.arc(s,n,2,0,2*Math.PI),h.fill()}(),function(){const t=p.y+1,e=p.x+1,{changes:s}=R.memory,{data:n}=j;let o;for(let r=0,a=s.length;r<a;r++){const{row:a,col:i,value:c}=s[r],h=(a+t)*L+4*(i+e);switch(c){case 1:n[h]=50,n[h+1]=205,n[h+2]=50;break;case 2:n[h]=0,n[h+1]=0,n[h+2]=0;break;case 3:n[h]=0,n[h+1]=0,n[h+2]=255,o={x:i,y:a}}n[h+3]=255}l.putImageData(j,0,0),l.fillStyle="#FF0000",l.beginPath(),l.arc(R.x+e,R.y+t,2,0,2*Math.PI),l.fill(),o&&(l.fillStyle="#0000FF",l.beginPath(),l.arc(o.x+e,o.y+t,2,0,2*Math.PI),l.fill())}(),z.innerText=`memory x: ${R.x}, y: ${R.y}`,J.innerText=R.goal?`x: ${R.goal.x}, y: ${R.goal.y}`:"searching",H.innerText=`actual x: ${R.x+p.x}, y: ${R.y+p.y}`,K=_.end(),setTimeout(t,6.944444444444445-K)}window.onload=async function(){console.log("Load ok"),c.drawImage(m,0,0),M.set(c.getImageData(0,0,f,x).data),c.fillStyle="#0000FF",c.beginPath(),c.arc(250,250,2,0,2*Math.PI),c.fill(),M.reset(),console.log("starting..."),V()},setInterval((()=>q.innerText="fps "+Math.floor(1e3/K)),100);let U=!1;function V(){const t=(d.s?-1:0)+(d.w?1:0),e=(d.d?-1:0)+(d.a?1:0);p.x+=e,p.y+=t,Q(U?N:V)}document.addEventListener("keydown",(({key:t})=>{" "!==t||U||(U=!0)}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zd2FybS1zaW11bGF0b3Ivd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vc3dhcm0tc2ltdWxhdG9yL3dlYnBhY2svcnVudGltZS9kZWZpbmUgcHJvcGVydHkgZ2V0dGVycyIsIndlYnBhY2s6Ly9zd2FybS1zaW11bGF0b3Ivd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly9zd2FybS1zaW11bGF0b3Ivd2VicGFjay9ydW50aW1lL21ha2UgbmFtZXNwYWNlIG9iamVjdCIsIndlYnBhY2s6Ly9zd2FybS1zaW11bGF0b3IvLi9zcmMvdXRpbC9tZW1vcnkudHMiLCJ3ZWJwYWNrOi8vc3dhcm0tc2ltdWxhdG9yLy4vc3JjL3V0aWwvaW5kZXgudHMiLCJ3ZWJwYWNrOi8vc3dhcm0tc2ltdWxhdG9yLy4vc3JjL3N0b3JlL2NhbnZhcy50cyIsIndlYnBhY2s6Ly9zd2FybS1zaW11bGF0b3IvLi9zcmMvb2JzdGFjbGUvaW5kZXgudHMiLCJ3ZWJwYWNrOi8vc3dhcm0tc2ltdWxhdG9yLy4vc3JjL3N0b3JlL29ic3RhY2xlcy50cyIsIndlYnBhY2s6Ly9zd2FybS1zaW11bGF0b3IvLi9zcmMvc3RvcmUvaW5kZXgudHMiLCJ3ZWJwYWNrOi8vc3dhcm0tc2ltdWxhdG9yLy4vc3JjL21hcC9pbmRleC50cyIsIndlYnBhY2s6Ly9zd2FybS1zaW11bGF0b3IvLi9zcmMvcGxheWVyL3JheS50cyIsIndlYnBhY2s6Ly9zd2FybS1zaW11bGF0b3IvLi9zcmMvcGF0aGZpbmRlci9hLXN0YXIvaW5kZXgudHMiLCJ3ZWJwYWNrOi8vc3dhcm0tc2ltdWxhdG9yLy4vc3JjL2RyYXcvcGxheWVyLnRzIiwid2VicGFjazovL3N3YXJtLXNpbXVsYXRvci8uL3NyYy9wbGF5ZXIvaW5kZXgudHMiLCJ3ZWJwYWNrOi8vc3dhcm0tc2ltdWxhdG9yLy4vc3JjL2luZGV4LnRzIiwid2VicGFjazovL3N3YXJtLXNpbXVsYXRvci8uL3NyYy9kcmF3L21hcC50cyJdLCJuYW1lcyI6WyJfX3dlYnBhY2tfcmVxdWlyZV9fIiwiZXhwb3J0cyIsImRlZmluaXRpb24iLCJrZXkiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0Iiwib2JqIiwicHJvcCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJNZW1vcnlDaGFuZ2VMaXN0IiwidGhpcyIsIm1lbW9yeSIsIk1hcCIsInJvdyIsImNvbCIsImhhcyIsInNldCIsIkFycmF5IiwiZnJvbSIsImtleXMiLCJkZWxldGUiLCJzdXBlciIsImNoYW5nZXMiLCJwdXNoIiwiZmFjdG9yIiwiTWF0aCIsIlBJIiwiY29zIiwiZGVncmVlcyIsInNpbiIsImFzeW5jIiwic2xlZXAiLCJ0aW1lIiwiUHJvbWlzZSIsInJlc29sdmUiLCJzZXRUaW1lb3V0IiwicmFuZEludCIsIm1pbiIsIm1heCIsImZsb29yIiwicmFuZG9tIiwibWFwQmFja2dyb3VuZENhbnZhcyIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJnZXRDb250ZXh0IiwiaW1hZ2VTbW9vdGhpbmdFbmFibGVkIiwibWFwTWFpbkNhbnZhcyIsInBsYXllck1haW5DYW52YXMiLCJwbGF5ZXJQYXRoQ2FudmFzIiwia2V5Ym9hcmQiLCJ3IiwiYSIsInMiLCJkIiwiYWRkRXZlbnRMaXN0ZW5lciIsIk9ic3RhY2xlIiwieCIsInkiLCJsZW5ndGgiLCJkaXIiLCJyeCIsInJ5Iiwicm91bmQiLCJvYnN0YWNsZXMiLCJhc3NpZ24iLCJpIiwibiIsInVwZGF0ZSIsIm1hemUiLCJJbWFnZSIsInNyYyIsIndpZHRoIiwiaGVpZ2h0Iiwic3RhcnQiLCJtYXAiLCJmaWxsIiwiZGF0YSIsInJlc2V0IiwiciIsImMiLCJmaWx0ZXIiLCJ2IiwiUmF5IiwiaW50ZWdyYWxzIiwiZHgiLCJkeSIsImdvYWwiLCJweCIsInB5IiwibXgiLCJteSIsImFicyIsInN4Iiwic3kiLCJlcnIiLCJjb29yZGluYXRlcyIsInVuZGVmaW5lZCIsImUyIiwicmF5SW50ZWdyYWxzIiwic3FydCIsImluaXQiLCJwbGF5ZXIiLCJlbmQiLCJkZyIsImRpc3QiLCJkcyIsImNvc3QiLCJyZXNldENoYW5nZXMiLCJjb21wdXRlIiwic29ydCIsIm1heENvc3QiLCJwYXJlbnQiLCJwb3AiLCJwZHMiLCJub2RlIiwiZ2V0UGF0aCIsIm9wZW5Db250YWlucyIsImIiLCJwYXRoIiwicGxheWVyTWFpbkltYWdlRGF0YSIsImNyZWF0ZUltYWdlRGF0YSIsInBsYXllclBhdGhJbWFnZURhdGEiLCJkcmF3UGxheWVyUGF0aCIsIm5vZGVzIiwicCIsInB1dEltYWdlRGF0YSIsInJheXMiLCJnb2FsRGlyZWN0aW9ucyIsInBhdGhmaW5kZXIiLCJsMXgxIiwibDF5MSIsImwxZGlyIiwibDF4MiIsImExIiwiYjEiLCJjMSIsImwyeDEiLCJsMnkxIiwibDJkaXIiLCJsMngyIiwiYTIiLCJiMiIsImMyIiwiY3giLCJjeSIsImV4IiwiZXkiLCJ0aGV0YSIsImF0YW4yIiwiZmluZEdvYWwiLCJjb21wdXRlUGF0aCIsInJheSIsImNvbGxpZGUiLCJwb2ludCIsImoiLCJ0aW1lciIsInBlcmZvcm1hbmNlIiwibm93IiwiZnBzRGlzcGxheSIsInBvc0Rpc3BsYXkiLCJhY3R1YWxQb3NEaXNwbGF5IiwiZ29hbEVzdGltYXRlRGlzcGxheSIsInQiLCJkcmF3IiwibmV4dCIsImNsZWFyUmVjdCIsInN0cm9rZVN0eWxlIiwiaW50IiwiYmVnaW5QYXRoIiwibW92ZVRvIiwibGluZVRvIiwic3Ryb2tlIiwiZmlsbFN0eWxlIiwiZm9yRWFjaCIsImZpbGxSZWN0IiwiYXJjIiwiZHJhd01hcCIsImRyYXdQbGF5ZXIiLCJpbm5lclRleHQiLCJ3aW5kb3ciLCJvbmxvYWQiLCJjb25zb2xlIiwibG9nIiwiZHJhd0ltYWdlIiwiZ2V0SW1hZ2VEYXRhIiwic2V0SW50ZXJ2YWwiLCJiZWdpbiJdLCJtYXBwaW5ncyI6Im1CQUNB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b3BlXG52YXIgX193ZWJwYWNrX3JlcXVpcmVfXyA9IHt9O1xuXG4iLCIvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9ucyBmb3IgaGFybW9ueSBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSAoZXhwb3J0cywgZGVmaW5pdGlvbikgPT4ge1xuXHRmb3IodmFyIGtleSBpbiBkZWZpbml0aW9uKSB7XG5cdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKGRlZmluaXRpb24sIGtleSkgJiYgIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBrZXkpKSB7XG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywga2V5LCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZGVmaW5pdGlvbltrZXldIH0pO1xuXHRcdH1cblx0fVxufTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSAob2JqLCBwcm9wKSA9PiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCkpIiwiLy8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5yID0gKGV4cG9ydHMpID0+IHtcblx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG5cdH1cblx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbn07IiwiZXhwb3J0IGNsYXNzIE1lbW9yeSB7XG4gICAgcHJvdGVjdGVkIG1lbW9yeTogTWFwPG51bWJlciwgTWFwPG51bWJlciwgbnVtYmVyPj47XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5tZW1vcnkgPSBuZXcgTWFwKCk7XG4gICAgfVxuXG4gICAgZ2V0KHJvdzogbnVtYmVyLCBjb2w6IG51bWJlcik6IG51bWJlciB8IHVuZGVmaW5lZCB7XG4gICAgICAgIHJldHVybiB0aGlzLm1lbW9yeS5nZXQocm93KT8uZ2V0KGNvbCk7XG4gICAgfVxuXG4gICAgc2V0KHJvdzogbnVtYmVyLCBjb2w6IG51bWJlciwgdmFsdWU6IG51bWJlcik6IHZvaWQge1xuICAgICAgICBjb25zdCB7IG1lbW9yeSB9ID0gdGhpcztcblxuICAgICAgICBpZiAoIW1lbW9yeS5oYXMocm93KSkgbWVtb3J5LnNldChyb3csIG5ldyBNYXAoKSk7XG5cbiAgICAgICAgbWVtb3J5LmdldChyb3cpIS5zZXQoY29sLCB2YWx1ZSk7XG4gICAgfVxuXG4gICAgcm93cygpOiBudW1iZXJbXSB7XG4gICAgICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMubWVtb3J5LmtleXMoKSk7XG4gICAgfVxuXG4gICAgY29scyhyb3c6IG51bWJlcik6IG51bWJlcltdIHtcbiAgICAgICAgcmV0dXJuIEFycmF5LmZyb20odGhpcy5tZW1vcnkuZ2V0KHJvdyk/LmtleXMoKSB8fCBbXSk7XG4gICAgfVxuXG4gICAgZGVsKHJvdzogbnVtYmVyLCBjb2w6IG51bWJlcik6IHZvaWQge1xuICAgICAgICB0aGlzLm1lbW9yeS5nZXQocm93KT8uZGVsZXRlKGNvbCk7XG4gICAgfVxufVxuXG5leHBvcnQgY2xhc3MgTWVtb3J5Q2hhbmdlTGlzdCBleHRlbmRzIE1lbW9yeSB7XG4gICAgY2hhbmdlczogeyByb3c6IG51bWJlcjsgY29sOiBudW1iZXI7IHZhbHVlOiBudW1iZXIgfVtdID0gW107XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICB9XG5cbiAgICBnZXQocm93OiBudW1iZXIsIGNvbDogbnVtYmVyKTogbnVtYmVyIHwgdW5kZWZpbmVkIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubWVtb3J5LmdldChyb3cpPy5nZXQoY29sKTtcbiAgICB9XG5cbiAgICBzZXQocm93OiBudW1iZXIsIGNvbDogbnVtYmVyLCB2YWx1ZTogbnVtYmVyKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IHsgbWVtb3J5LCBjaGFuZ2VzIH0gPSB0aGlzO1xuXG4gICAgICAgIGlmICghbWVtb3J5Lmhhcyhyb3cpKSBtZW1vcnkuc2V0KHJvdywgbmV3IE1hcCgpKTtcblxuICAgICAgICBtZW1vcnkuZ2V0KHJvdykhLnNldChjb2wsIHZhbHVlKTtcbiAgICAgICAgY2hhbmdlcy5wdXNoKHsgcm93LCBjb2wsIHZhbHVlIH0pO1xuICAgIH1cblxuICAgIHJvd3MoKTogbnVtYmVyW10ge1xuICAgICAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLm1lbW9yeS5rZXlzKCkpO1xuICAgIH1cblxuICAgIGNvbHMocm93OiBudW1iZXIpOiBudW1iZXJbXSB7XG4gICAgICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMubWVtb3J5LmdldChyb3cpPy5rZXlzKCkgfHwgW10pO1xuICAgIH1cblxuICAgIGRlbChyb3c6IG51bWJlciwgY29sOiBudW1iZXIpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5tZW1vcnkuZ2V0KHJvdyk/LmRlbGV0ZShjb2wpO1xuICAgIH1cblxuICAgIHJlc2V0KCk6IHZvaWQge1xuICAgICAgICAvLyBjb25zb2xlLmxvZyh0aGlzLmNoYW5nZXMubGVuZ3RoKTtcbiAgICAgICAgdGhpcy5jaGFuZ2VzID0gW107XG4gICAgfVxufVxuIiwiZXhwb3J0IGNsYXNzIFRpbWVyIHtcbiAgICBwcml2YXRlIHRpbWUgPSAwO1xuXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuc3RhcnQoKTtcbiAgICB9XG5cbiAgICBzdGFydCgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy50aW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgfVxuXG4gICAgZW5kKCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiBwZXJmb3JtYW5jZS5ub3coKSAtIHRoaXMudGltZTtcbiAgICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpbnRlZ3JhbHMoXG4gICAgeDA6IG51bWJlcixcbiAgICB5MDogbnVtYmVyLFxuICAgIHgxOiBudW1iZXIsXG4gICAgeTE6IG51bWJlclxuKTogeyB4OiBudW1iZXI7IHk6IG51bWJlciB9W10ge1xuICAgIGNvbnN0IGR4ID0gTWF0aC5hYnMoeDEgLSB4MCk7XG4gICAgY29uc3QgZHkgPSBNYXRoLmFicyh5MSAtIHkwKTtcbiAgICBjb25zdCBzeCA9IHgwIDwgeDEgPyAxIDogLTE7XG4gICAgY29uc3Qgc3kgPSB5MCA8IHkxID8gMSA6IC0xO1xuICAgIGxldCBlcnIgPSBkeCAtIGR5O1xuXG4gICAgY29uc3QgY29vcmRpbmF0ZXMgPSBbXTtcblxuICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICAgIGNvb3JkaW5hdGVzLnB1c2goeyB4OiB4MCwgeTogeTAgfSk7XG5cbiAgICAgICAgaWYgKHgwID09PSB4MSAmJiB5MCA9PT0geTEpIHJldHVybiBjb29yZGluYXRlcztcbiAgICAgICAgY29uc3QgZTIgPSAyICogZXJyO1xuICAgICAgICBpZiAoZTIgPiAtZHkpIHtcbiAgICAgICAgICAgIGVyciAtPSBkeTtcbiAgICAgICAgICAgIHgwICs9IHN4O1xuICAgICAgICB9XG4gICAgICAgIGlmIChlMiA8IGR4KSB7XG4gICAgICAgICAgICBlcnIgKz0gZHg7XG4gICAgICAgICAgICB5MCArPSBzeTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuY29uc3QgZmFjdG9yID0gTWF0aC5QSSAvIDE4MDtcblxuZXhwb3J0IGZ1bmN0aW9uIGNvcyhkZWdyZWVzOiBudW1iZXIpOiBudW1iZXIge1xuICAgIHJldHVybiBNYXRoLmNvcyhkZWdyZWVzICogZmFjdG9yKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNpbihkZWdyZWVzOiBudW1iZXIpOiBudW1iZXIge1xuICAgIHJldHVybiBNYXRoLnNpbihkZWdyZWVzICogZmFjdG9yKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGRpcihjeDogbnVtYmVyLCBjeTogbnVtYmVyLCBleDogbnVtYmVyLCBleTogbnVtYmVyKTogbnVtYmVyIHtcbiAgICBjb25zdCBkeCA9IGN4IC0gZXg7XG4gICAgY29uc3QgZHkgPSBjeSAtIGV5O1xuXG4gICAgY29uc3QgdGhldGEgPSAoTWF0aC5hdGFuMigtZHksIC1keCkgKiAxODApIC8gTWF0aC5QSTtcblxuICAgIHJldHVybiB0aGV0YSA8IDAgPyB0aGV0YSArIDM2MCA6IHRoZXRhO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2xlZXAodGltZSA9IDApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2U8dm9pZD4oKHJlc29sdmUpID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgdGltZSkpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcmFuZEludChtaW46IG51bWJlciwgbWF4OiBudW1iZXIpOiBudW1iZXIge1xuICAgIHJldHVybiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAobWF4IC0gbWluICsgMSkgKyBtaW4pXG59XG5cbmV4cG9ydCBmdW5jdGlvbiByb3VuZChuOiBudW1iZXIsIGQgPSAyKTogbnVtYmVyIHtcbiAgICByZXR1cm4gK24udG9GaXhlZChkKTtcbn1cblxuZXhwb3J0ICogZnJvbSAnLi9tZW1vcnknO1xuIiwiZXhwb3J0IGNvbnN0IG1hcEJhY2tncm91bmRDYW52YXMgPSAoXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcC1iYWNrZ3JvdW5kLWxheWVyJykgYXMgSFRNTENhbnZhc0VsZW1lbnRcbikuZ2V0Q29udGV4dCgnMmQnKSE7XG5tYXBCYWNrZ3JvdW5kQ2FudmFzLmltYWdlU21vb3RoaW5nRW5hYmxlZCA9IGZhbHNlO1xuXG5leHBvcnQgY29uc3QgbWFwTWFpbkNhbnZhcyA9IChcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwLW1haW4tbGF5ZXInKSBhcyBIVE1MQ2FudmFzRWxlbWVudFxuKS5nZXRDb250ZXh0KCcyZCcpITtcbm1hcE1haW5DYW52YXMuaW1hZ2VTbW9vdGhpbmdFbmFibGVkID0gZmFsc2U7XG5cbmV4cG9ydCBjb25zdCBwbGF5ZXJNYWluQ2FudmFzID0gKFxuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwbGF5ZXItbWFpbi1sYXllcicpIGFzIEhUTUxDYW52YXNFbGVtZW50XG4pLmdldENvbnRleHQoJzJkJykhO1xucGxheWVyTWFpbkNhbnZhcy5pbWFnZVNtb290aGluZ0VuYWJsZWQgPSBmYWxzZTtcblxuZXhwb3J0IGNvbnN0IHBsYXllclBhdGhDYW52YXMgPSAoXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BsYXllci1wYXRoLWxheWVyJykgYXMgSFRNTENhbnZhc0VsZW1lbnRcbikuZ2V0Q29udGV4dCgnMmQnKSE7XG5wbGF5ZXJQYXRoQ2FudmFzLmltYWdlU21vb3RoaW5nRW5hYmxlZCA9IGZhbHNlO1xuXG5leHBvcnQgY29uc3Qga2V5Ym9hcmQgPSB7XG4gICAgdzogZmFsc2UsXG4gICAgYTogZmFsc2UsXG4gICAgczogZmFsc2UsXG4gICAgZDogZmFsc2UsXG59O1xuXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgKHsga2V5IH0pID0+IHtcbiAgICBzd2l0Y2ggKGtleSkge1xuICAgICAgICBjYXNlICd3JzpcbiAgICAgICAgICAgIGtleWJvYXJkLncgPSB0cnVlO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ2EnOlxuICAgICAgICAgICAga2V5Ym9hcmQuYSA9IHRydWU7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAncyc6XG4gICAgICAgICAgICBrZXlib2FyZC5zID0gdHJ1ZTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdkJzpcbiAgICAgICAgICAgIGtleWJvYXJkLmQgPSB0cnVlO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgfVxufSk7XG5cbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgKHsga2V5IH0pID0+IHtcbiAgICBzd2l0Y2ggKGtleSkge1xuICAgICAgICBjYXNlICd3JzpcbiAgICAgICAgICAgIGtleWJvYXJkLncgPSBmYWxzZTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdhJzpcbiAgICAgICAgICAgIGtleWJvYXJkLmEgPSBmYWxzZTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdzJzpcbiAgICAgICAgICAgIGtleWJvYXJkLnMgPSBmYWxzZTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdkJzpcbiAgICAgICAgICAgIGtleWJvYXJkLmQgPSBmYWxzZTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgIH1cbn0pO1xuIiwiaW1wb3J0IHsgY29zLCBzaW4gfSBmcm9tICcuLi91dGlsJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgT2JzdGFjbGUge1xuICAgIHg6IG51bWJlcjtcbiAgICB5OiBudW1iZXI7XG4gICAgcHJpdmF0ZSBkaXI6IG51bWJlcjtcbiAgICBwcml2YXRlIHJlYWRvbmx5IHJ4OiBudW1iZXI7XG4gICAgcHJpdmF0ZSByZWFkb25seSByeTogbnVtYmVyO1xuICAgIHByaXZhdGUgcmVhZG9ubHkgbGVuZ3RoOiBudW1iZXI7XG5cbiAgICBjb25zdHJ1Y3Rvcih4ID0gMjUwLCB5ID0gMjUwLCBsZW5ndGggPSAzMCwgZGlyID0gMCkge1xuICAgICAgICB0aGlzLnggPSB4ICsgbGVuZ3RoO1xuICAgICAgICB0aGlzLnkgPSB5ICsgbGVuZ3RoO1xuICAgICAgICB0aGlzLnJ4ID0geDtcbiAgICAgICAgdGhpcy5yeSA9IHk7XG4gICAgICAgIHRoaXMuZGlyID0gZGlyO1xuICAgICAgICB0aGlzLmxlbmd0aCA9IGxlbmd0aDtcbiAgICB9XG5cbiAgICB1cGRhdGUoKTogeyB4OiBudW1iZXI7IHk6IG51bWJlciB9IHtcbiAgICAgICAgdGhpcy5kaXIrKztcbiAgICAgICAgaWYgKHRoaXMuZGlyID49IDM2MCkgdGhpcy5kaXIgPSAwO1xuXG4gICAgICAgIGNvbnN0IHsgZGlyIH0gPSB0aGlzO1xuXG4gICAgICAgIGNvbnN0IHggPSB0aGlzLmxlbmd0aDtcbiAgICAgICAgY29uc3QgeSA9IDA7XG5cbiAgICAgICAgdGhpcy54ID0gdGhpcy5yeCArIE1hdGgucm91bmQoeCAqIGNvcyhkaXIpIC0geSAqIHNpbihkaXIpKTtcbiAgICAgICAgdGhpcy55ID0gdGhpcy5yeSArIE1hdGgucm91bmQoeCAqIHNpbihkaXIpICsgeSAqIGNvcyhkaXIpKTtcblxuICAgICAgICByZXR1cm4geyB4OiB0aGlzLngsIHk6IHRoaXMueSB9O1xuICAgIH1cbn1cbiIsImltcG9ydCBPYnN0YWNsZSBmcm9tICcuLi9vYnN0YWNsZSc7XG5cbmludGVyZmFjZSBPYnN0YWNsZXMgZXh0ZW5kcyBBcnJheTxPYnN0YWNsZT4ge1xuICAgIHVwZGF0ZSgpOiB2b2lkO1xufVxuXG5leHBvcnQgY29uc3Qgb2JzdGFjbGVzOiBPYnN0YWNsZXMgPSBPYmplY3QuYXNzaWduKFtdLCB7XG4gICAgdXBkYXRlKCk6IHZvaWQge1xuICAgICAgICBmb3IgKGxldCBpID0gMCwgbiA9IG9ic3RhY2xlcy5sZW5ndGg7IGkgPCBuOyBpKyspIG9ic3RhY2xlc1tpXS51cGRhdGUoKTtcbiAgICB9LFxufSk7XG5mb3IgKGxldCBpID0gMzA7IGkgPCA1MDsgaSsrKSBvYnN0YWNsZXMucHVzaChuZXcgT2JzdGFjbGUoMjUwLCAyNTAsIGkpKTtcbiIsImV4cG9ydCBjb25zdCBtYXplID0gbmV3IEltYWdlKCk7XG5tYXplLnNyYyA9ICdhc3NldHMvbWF6ZS5wbmcnO1xuXG5leHBvcnQgY29uc3Qgd2lkdGggPSBtYXplLndpZHRoO1xuZXhwb3J0IGNvbnN0IGhlaWdodCA9IG1hemUuaGVpZ2h0O1xuXG5leHBvcnQgY29uc3Qgc3RhcnQgPSB7XG4gICAgeDogMTAwLFxuICAgIHk6IDEwMCxcbn1cblxuZXhwb3J0IGNvbnN0IGdvYWwgPSB7XG4gICAgeDogMjUwLFxuICAgIHk6IDI1MCxcbn07XG5cbmV4cG9ydCAqIGZyb20gJy4vY2FudmFzJztcblxuZXhwb3J0ICogZnJvbSAnLi9vYnN0YWNsZXMnO1xuIiwiaW1wb3J0IHsgZ29hbCwgaGVpZ2h0LCBvYnN0YWNsZXMsIHdpZHRoIH0gZnJvbSAnLi4vc3RvcmUnO1xuXG5pbnRlcmZhY2UgVmlldyBleHRlbmRzIEFycmF5PEFycmF5PG51bWJlcj4+IHtcbiAgICBkYXRhOiBudW1iZXJbXTtcblxuICAgIGRpcjogbnVtYmVyO1xuXG4gICAgcmVzZXQoKTogdm9pZDtcblxuICAgIHNldChkYXRhOiBVaW50OENsYW1wZWRBcnJheSk6IHZvaWQ7XG59XG5cbmNvbnN0IG1hcDogVmlldyA9IE9iamVjdC5hc3NpZ24oXG4gICAgbmV3IEFycmF5KGhlaWdodCkuZmlsbCgwKS5tYXAoKCkgPT4gbmV3IEFycmF5KHdpZHRoKS5maWxsKDApKSxcbiAgICB7XG4gICAgICAgIGRhdGE6IFtdIGFzIG51bWJlcltdLFxuICAgICAgICBkaXI6IDAsXG4gICAgICAgIHJlc2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBjb25zdCB7IGRhdGEgfSA9IHRoaXM7XG5cbiAgICAgICAgICAgIC8vIFN0YXRpYyBvYnN0YWNsZXNcbiAgICAgICAgICAgIGZvciAobGV0IHIgPSAwLCBuID0gaGVpZ2h0OyByIDwgbjsgcisrKSB7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgYyA9IDAsIG4gPSB3aWR0aDsgYyA8IG47IGMrKykgbWFwW3JdW2NdID0gKyFkYXRhW3IgKiB3aWR0aCArIGNdO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBEeW5hbWljIG9ic3RhY2xlc1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIG4gPSBvYnN0YWNsZXMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyB4LCB5IH0gPSBvYnN0YWNsZXNbaV07XG4gICAgICAgICAgICAgICAgbWFwW3ldW3hdID0gMTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gR29hbCBpbiBtYXBcbiAgICAgICAgICAgIG1hcFtnb2FsLnldW2dvYWwueF0gPSAxMDA7XG4gICAgICAgIH0sXG4gICAgICAgIHNldChkYXRhOiBVaW50OENsYW1wZWRBcnJheSkge1xuICAgICAgICAgICAgdGhpcy5kYXRhID0gQXJyYXkuZnJvbShkYXRhLmZpbHRlcigodiwgaSkgPT4gaSAlIDQgPT09IDApKTtcbiAgICAgICAgfSxcbiAgICB9XG4pO1xuXG5leHBvcnQgZGVmYXVsdCBtYXA7XG4iLCJpbXBvcnQgbWFwIGZyb20gJy4uL21hcCc7XG5pbXBvcnQgeyBjb3MsIHNpbiB9IGZyb20gJy4uL3V0aWwnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBSYXkge1xuICAgIHJlYWRvbmx5IGRpcjogbnVtYmVyO1xuICAgIGludGVncmFsczogeyB4OiBudW1iZXI7IHk6IG51bWJlciB9W10gPSBbXTtcbiAgICBwcml2YXRlIHJlYWRvbmx5IGR4OiBudW1iZXI7XG4gICAgcHJpdmF0ZSByZWFkb25seSBkeTogbnVtYmVyO1xuXG4gICAgY29uc3RydWN0b3IoZGlyOiBudW1iZXIsIGxlbmd0aCA9IDEwMCkge1xuICAgICAgICB0aGlzLmRpciA9IGRpcjtcbiAgICAgICAgY29uc3QgeCA9IGxlbmd0aDtcbiAgICAgICAgY29uc3QgeSA9IDA7XG5cbiAgICAgICAgdGhpcy5keCA9IE1hdGgucm91bmQoeCAqIGNvcyhkaXIpIC0geSAqIHNpbihkaXIpKTtcbiAgICAgICAgdGhpcy5keSA9IE1hdGgucm91bmQoeCAqIHNpbihkaXIpICsgeSAqIGNvcyhkaXIpKTtcbiAgICB9XG5cbiAgICAvLyBFbXB0eSBwb2ludHM7IENvbGxpc2lvbiBwb2ludFxuICAgIHVwZGF0ZSh4OiBudW1iZXIsIHk6IG51bWJlcik6IFtib29sZWFuLCB7IHg6IG51bWJlcjsgeTogbnVtYmVyIH0/LCB7IHg6IG51bWJlcjsgeTogbnVtYmVyIH0/XSB7XG4gICAgICAgIGNvbnN0IFtpbnRlZ3JhbHMsIGNvbCwgZ29hbF0gPSByYXlJbnRlZ3JhbHMoeCwgeSwgeCArIHRoaXMuZHgsIHkgKyB0aGlzLmR5KTtcbiAgICAgICAgdGhpcy5pbnRlZ3JhbHMgPSBpbnRlZ3JhbHM7XG5cbiAgICAgICAgcmV0dXJuIFtpbnRlZ3JhbHMubGVuZ3RoID09PSAwLCBjb2wsIGdvYWxdO1xuICAgIH1cbn1cblxuLy8gRW1wdHkgcG9pbnRzOyBDb2xsaXNpb24gcG9pbnQ7IEdvYWxcbmZ1bmN0aW9uIHJheUludGVncmFscyhcbiAgICBweDogbnVtYmVyLFxuICAgIHB5OiBudW1iZXIsXG4gICAgbXg6IG51bWJlcixcbiAgICBteTogbnVtYmVyXG4pOiBbeyB4OiBudW1iZXI7IHk6IG51bWJlciB9W10sIHsgeDogbnVtYmVyOyB5OiBudW1iZXIgfT8sIHsgeDogbnVtYmVyOyB5OiBudW1iZXIgfT9dIHtcbiAgICBjb25zdCBkeCA9IE1hdGguYWJzKG14IC0gcHgpO1xuICAgIGNvbnN0IGR5ID0gTWF0aC5hYnMobXkgLSBweSk7XG4gICAgY29uc3Qgc3ggPSBweCA8IG14ID8gMSA6IC0xO1xuICAgIGNvbnN0IHN5ID0gcHkgPCBteSA/IDEgOiAtMTtcbiAgICBsZXQgZXJyID0gZHggLSBkeTtcblxuICAgIGNvbnN0IGNvb3JkaW5hdGVzID0gW107XG5cbiAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgICBjb25zdCByb3cgPSBtYXBbcHldO1xuICAgICAgICBjb25zdCBjb2wgPSByb3c/LltweF07XG5cbiAgICAgICAgLy8gVGVybWluYXRlIG9uIGdvYWwgZm91bmRcbiAgICAgICAgaWYgKGNvbCA9PT0gMTAwKSByZXR1cm4gW2Nvb3JkaW5hdGVzLCB1bmRlZmluZWQsIHsgeDogcHgsIHk6IHB5IH1dO1xuXG4gICAgICAgIC8qIFRlcm1pbmF0ZSBvbjpcbiAgICAgICAgUm93IG91dCBvZiBib3VuZHNcbiAgICAgICAgQ29sIG91dCBvZiBib3VuZHNcbiAgICAgICAgQ29sIGlzIHdhbGxcbiAgICAgICAgICovXG4gICAgICAgIGlmIChjb2wgPT09IHVuZGVmaW5lZCB8fCBjb2wgPT09IDEpIHJldHVybiBbY29vcmRpbmF0ZXMsIHsgeDogcHgsIHk6IHB5IH0sIHVuZGVmaW5lZF07XG5cbiAgICAgICAgLy8gVGVybWluYXRlIG9uIG1heCBsZW5ndGggcmVhY2hlZDsgTm8gY29sbGlzaW9uXG4gICAgICAgIGlmIChweCA9PT0gbXggJiYgcHkgPT09IG15KSByZXR1cm4gW2Nvb3JkaW5hdGVzLCB1bmRlZmluZWRdO1xuXG4gICAgICAgIGNvb3JkaW5hdGVzLnB1c2goeyB4OiBweCwgeTogcHkgfSk7XG4gICAgICAgIGNvbnN0IGUyID0gMiAqIGVycjtcbiAgICAgICAgaWYgKGUyID4gLWR5KSB7XG4gICAgICAgICAgICBlcnIgLT0gZHk7XG4gICAgICAgICAgICBweCArPSBzeDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZTIgPCBkeCkge1xuICAgICAgICAgICAgZXJyICs9IGR4O1xuICAgICAgICAgICAgcHkgKz0gc3k7XG4gICAgICAgIH1cbiAgICB9XG59XG4iLCJpbXBvcnQgeyBNZW1vcnlDaGFuZ2VMaXN0IH0gZnJvbSAnLi4vLi4vdXRpbCc7XG5pbXBvcnQgeyBQbGF5ZXIgfSBmcm9tICcuLi8uLi9wbGF5ZXInO1xuXG50eXBlIE5vZGUgPSB7XG4gICAgeDogbnVtYmVyO1xuICAgIHk6IG51bWJlcjtcbiAgICBkczogbnVtYmVyO1xuICAgIGRnOiBudW1iZXI7XG4gICAgY29zdDogbnVtYmVyO1xuICAgIHBhcmVudD86IE5vZGU7XG59O1xuXG5jb25zdCB7IHNxcnQgfSA9IE1hdGg7XG5cbmxldCBnb2FsOiB7IHg6IG51bWJlcjsgeTogbnVtYmVyIH07XG5sZXQgb3BlbjogTm9kZVtdO1xubGV0IG1lbW9yeTogTWVtb3J5Q2hhbmdlTGlzdDtcbmxldCBjbG9zZWQ6IE1lbW9yeUNoYW5nZUxpc3Q7XG5cbmV4cG9ydCBmdW5jdGlvbiBpbml0KHBsYXllcjogUGxheWVyLCBlbmQ6IHsgeDogbnVtYmVyOyB5OiBudW1iZXIgfSk6IHZvaWQge1xuICAgIG9wZW4gPSBbXTtcbiAgICBnb2FsID0gZW5kO1xuICAgIG1lbW9yeSA9IHBsYXllci5tZW1vcnk7XG4gICAgY2xvc2VkID0gbmV3IE1lbW9yeUNoYW5nZUxpc3QoKTtcblxuICAgIC8vIGNvbnNvbGUubG9nKG9wZW4sIGdvYWwsIG1lbW9yeSwgY2xvc2VkKTtcblxuICAgIGNvbnN0IHsgeCwgeSB9ID0gcGxheWVyO1xuXG4gICAgY29uc3QgZGcgPSBkaXN0KHsgeCwgeSB9LCBnb2FsKTtcbiAgICBvcGVuLnB1c2goe1xuICAgICAgICB4LFxuICAgICAgICB5LFxuICAgICAgICBkczogMCxcbiAgICAgICAgZGcsXG4gICAgICAgIGNvc3Q6IGRnLFxuICAgIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY2hhbmdlcygpOiB7IHJvdzogbnVtYmVyOyBjb2w6IG51bWJlcjsgdmFsdWU6IG51bWJlciB9W10ge1xuICAgIHJldHVybiBjbG9zZWQuY2hhbmdlcztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlc2V0Q2hhbmdlcygpOiB2b2lkIHtcbiAgICBjbG9zZWQucmVzZXQoKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNvbXB1dGUoKTogeyB4OiBudW1iZXI7IHk6IG51bWJlciB9W10gfCB1bmRlZmluZWQge1xuICAgIG9wZW4uc29ydChtYXhDb3N0KTtcbiAgICBjb25zdCBwYXJlbnQgPSBvcGVuLnBvcCgpITtcblxuICAgIGNvbnN0IHsgeDogcHgsIHk6IHB5LCBkczogcGRzIH0gPSBwYXJlbnQ7XG5cbiAgICBjbG9zZWQuc2V0KHB5LCBweCwgMSk7XG5cbiAgICAvLyB5IC0gMSB0byB5ICsgMVxuICAgIGZvciAobGV0IHkgPSBweSArIDI7IC0teSA+PSBweSAtIDE7ICkge1xuICAgICAgICAvLyB4IC0gMSB0byB4ICsgMVxuICAgICAgICBmb3IgKGxldCB4ID0gcHggKyAyOyAtLXggPj0gcHggLSAxOyApIHtcbiAgICAgICAgICAgIGNvbnN0IG5vZGUgPSB7IHgsIHksIHBhcmVudCB9O1xuXG4gICAgICAgICAgICBjb25zdCBjb2wgPSBtZW1vcnkuZ2V0KHksIHgpO1xuXG4gICAgICAgICAgICAvLyBHb2FsIGZvdW5kXG4gICAgICAgICAgICBpZiAoeCA9PT0gZ29hbC54ICYmIHkgPT09IGdvYWwueSkgcmV0dXJuIGdldFBhdGgobm9kZSwgW10pO1xuXG4gICAgICAgICAgICAvLyBPYnN0YWNsZSBvciBQb2ludCBhbHJlYWR5IGV4cGFuZGVkXG4gICAgICAgICAgICBpZiAoY29sID09PSAyIHx8IGNsb3NlZC5nZXQoeSwgeCkgPT09IDEpIGNvbnRpbnVlO1xuXG4gICAgICAgICAgICAvLyB3ZWlnaHRlZFxuICAgICAgICAgICAgY29uc3QgZHMgPSBwZHMgKiAwLjk1ICsgZGlzdChub2RlLCBwYXJlbnQpO1xuICAgICAgICAgICAgY29uc3QgZGcgPSBkaXN0KG5vZGUsIGdvYWwpO1xuICAgICAgICAgICAgY29uc3QgY29zdCA9IGRzICsgZGc7XG5cbiAgICAgICAgICAgIGNvbnN0IG8gPSBvcGVuQ29udGFpbnMobm9kZSk7XG5cbiAgICAgICAgICAgIGlmIChvKSB7XG4gICAgICAgICAgICAgICAgaWYgKG8uY29zdCA+IGNvc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgby5jb3N0ID0gY29zdDtcbiAgICAgICAgICAgICAgICAgICAgby5kcyA9IGRzO1xuICAgICAgICAgICAgICAgICAgICBvLmRnID0gZGc7XG4gICAgICAgICAgICAgICAgICAgIG8ucGFyZW50ID0gcGFyZW50O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgb3Blbi5wdXNoKHsgLi4ubm9kZSwgY29zdCwgZHMsIGRnIH0pO1xuICAgICAgICAgICAgICAgIC8vIG1hcFt5XVt4XSA9IDIwMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cblxuZnVuY3Rpb24gZGlzdChhOiB7IHg6IG51bWJlcjsgeTogbnVtYmVyIH0sIGI6IHsgeDogbnVtYmVyOyB5OiBudW1iZXIgfSk6IG51bWJlciB7XG4gICAgY29uc3QgZHggPSBhLnggLSBiLng7XG4gICAgY29uc3QgZHkgPSBhLnkgLSBiLnk7XG4gICAgcmV0dXJuIHNxcnQoZHggKiBkeCArIGR5ICogZHkpO1xufVxuXG5mdW5jdGlvbiBtYXhDb3N0KGE6IE5vZGUsIGI6IE5vZGUpOiBudW1iZXIge1xuICAgIC8vIHJldHVybiBhLmNvc3QgLSBiLmNvc3QgfHwgYS5kZyAtIGIuZGc7IC8vIG1pbiBjb3N0XG4gICAgcmV0dXJuIGIuY29zdCAtIGEuY29zdCB8fCBiLmRnIC0gYS5kZztcbn1cblxuZnVuY3Rpb24gZ2V0UGF0aChcbiAgICBub2RlOiB7IHg6IG51bWJlcjsgeTogbnVtYmVyOyBwYXJlbnQ/OiBOb2RlIH0sXG4gICAgcGF0aDogeyB4OiBudW1iZXI7IHk6IG51bWJlciB9W11cbik6IHsgeDogbnVtYmVyOyB5OiBudW1iZXIgfVtdIHtcbiAgICBwYXRoLnB1c2gobm9kZSk7XG4gICAgY29uc3QgeyBwYXJlbnQgfSA9IG5vZGU7XG4gICAgcmV0dXJuIHBhcmVudCA/IGdldFBhdGgocGFyZW50LCBwYXRoKSA6IHBhdGg7XG59XG5cbmZ1bmN0aW9uIG9wZW5Db250YWlucyhub2RlOiB7IHg6IG51bWJlcjsgeTogbnVtYmVyIH0pOiBOb2RlIHwgdW5kZWZpbmVkIHtcbiAgICBjb25zdCB7IHgsIHkgfSA9IG5vZGU7XG5cbiAgICAvLyBmb3IgKGxldCBpID0gMCwgbiA9IG9wZW4ubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XG4gICAgZm9yIChsZXQgaSA9IG9wZW4ubGVuZ3RoOyAtLWkgPj0gMDsgKSB7XG4gICAgICAgIGNvbnN0IG5vZGUgPSBvcGVuW2ldO1xuICAgICAgICBpZiAoeCA9PT0gbm9kZS54ICYmIHkgPT09IG5vZGUueSkgcmV0dXJuIG5vZGU7XG4gICAgfVxufVxuIiwiaW1wb3J0IHBsYXllciBmcm9tICcuLi9wbGF5ZXInO1xuaW1wb3J0IHsgY2hhbmdlcywgcmVzZXRDaGFuZ2VzIH0gZnJvbSAnLi4vcGF0aGZpbmRlci9hLXN0YXInO1xuaW1wb3J0IHtcbiAgICBoZWlnaHQsXG4gICAgcGxheWVyTWFpbkNhbnZhcyxcbiAgICBwbGF5ZXJQYXRoQ2FudmFzLFxuICAgIHN0YXJ0LFxuICAgIHdpZHRoLFxufSBmcm9tICcuLi9zdG9yZSc7XG5cbmNvbnN0IHBsYXllck1haW5JbWFnZURhdGEgPSBwbGF5ZXJNYWluQ2FudmFzLmNyZWF0ZUltYWdlRGF0YSh3aWR0aCArIDIsIGhlaWdodCArIDIpO1xubGV0IHBsYXllclBhdGhJbWFnZURhdGEgPSBwbGF5ZXJQYXRoQ2FudmFzLmNyZWF0ZUltYWdlRGF0YSh3aWR0aCArIDIsIGhlaWdodCArIDIpO1xuY29uc3QgdyA9ICh3aWR0aCArIDIpICogNDtcblxuZXhwb3J0IGZ1bmN0aW9uIGRyYXdQbGF5ZXIoKTogdm9pZCB7XG4gICAgY29uc3QgZHkgPSBzdGFydC55ICsgMTtcbiAgICBjb25zdCBkeCA9IHN0YXJ0LnggKyAxO1xuICAgIGNvbnN0IHsgY2hhbmdlcyB9ID0gcGxheWVyLm1lbW9yeTtcbiAgICBjb25zdCB7IGRhdGEgfSA9IHBsYXllck1haW5JbWFnZURhdGE7XG5cbiAgICBsZXQgZ29hbDogeyB4OiBudW1iZXI7IHk6IG51bWJlciB9IHwgdW5kZWZpbmVkO1xuXG4gICAgZm9yIChsZXQgaSA9IDAsIG4gPSBjaGFuZ2VzLmxlbmd0aDsgaSA8IG47IGkrKykge1xuICAgICAgICBjb25zdCB7IHJvdywgY29sLCB2YWx1ZSB9ID0gY2hhbmdlc1tpXTtcbiAgICAgICAgY29uc3QgcCA9IChyb3cgKyBkeSkgKiB3ICsgKGNvbCArIGR4KSAqIDQ7XG5cbiAgICAgICAgc3dpdGNoICh2YWx1ZSkge1xuICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgIC8vIEVtcHR5IHBvaW50XG4gICAgICAgICAgICAgICAgZGF0YVtwXSA9IDUwO1xuICAgICAgICAgICAgICAgIGRhdGFbcCArIDFdID0gMjA1O1xuICAgICAgICAgICAgICAgIGRhdGFbcCArIDJdID0gNTA7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgLy8gT2JzdGFjbGVcbiAgICAgICAgICAgICAgICBkYXRhW3BdID0gMDtcbiAgICAgICAgICAgICAgICBkYXRhW3AgKyAxXSA9IDA7XG4gICAgICAgICAgICAgICAgZGF0YVtwICsgMl0gPSAwO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgIC8vIEdvYWxcbiAgICAgICAgICAgICAgICBkYXRhW3BdID0gMDtcbiAgICAgICAgICAgICAgICBkYXRhW3AgKyAxXSA9IDA7XG4gICAgICAgICAgICAgICAgZGF0YVtwICsgMl0gPSAyNTU7XG4gICAgICAgICAgICAgICAgZ29hbCA9IHsgeDogY29sLCB5OiByb3cgfTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICAgIGRhdGFbcCArIDNdID0gMjU1O1xuICAgIH1cbiAgICBwbGF5ZXJNYWluQ2FudmFzLnB1dEltYWdlRGF0YShwbGF5ZXJNYWluSW1hZ2VEYXRhLCAwLCAwKTtcblxuICAgIC8vIERyYXcgcGxheWVyXG4gICAgcGxheWVyTWFpbkNhbnZhcy5maWxsU3R5bGUgPSAnI0ZGMDAwMCc7XG4gICAgcGxheWVyTWFpbkNhbnZhcy5iZWdpblBhdGgoKTtcbiAgICBwbGF5ZXJNYWluQ2FudmFzLmFyYyhwbGF5ZXIueCArIGR4LCBwbGF5ZXIueSArIGR5LCAyLCAwLCAyICogTWF0aC5QSSk7XG4gICAgcGxheWVyTWFpbkNhbnZhcy5maWxsKCk7XG5cbiAgICAvLyBEcmF3IGdvYWxcbiAgICBpZiAoZ29hbCkge1xuICAgICAgICBwbGF5ZXJNYWluQ2FudmFzLmZpbGxTdHlsZSA9ICcjMDAwMEZGJztcbiAgICAgICAgcGxheWVyTWFpbkNhbnZhcy5iZWdpblBhdGgoKTtcbiAgICAgICAgcGxheWVyTWFpbkNhbnZhcy5hcmMoZ29hbC54ICsgZHgsIGdvYWwueSArIGR5LCAyLCAwLCAyICogTWF0aC5QSSk7XG4gICAgICAgIHBsYXllck1haW5DYW52YXMuZmlsbCgpO1xuICAgIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlc2V0UGxheWVyUGF0aCgpOiB2b2lkIHtcbiAgICBwbGF5ZXJQYXRoSW1hZ2VEYXRhID0gcGxheWVyUGF0aENhbnZhcy5jcmVhdGVJbWFnZURhdGEod2lkdGggKyAyLCBoZWlnaHQgKyAyKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGRyYXdQbGF5ZXJQYXRoKCk6IHZvaWQge1xuICAgIGNvbnN0IGR5ID0gc3RhcnQueSArIDE7XG4gICAgY29uc3QgZHggPSBzdGFydC54ICsgMTtcbiAgICBjb25zdCB7IGRhdGEgfSA9IHBsYXllclBhdGhJbWFnZURhdGE7XG5cbiAgICBjb25zdCBub2RlcyA9IGNoYW5nZXMoKTtcbiAgICBmb3IgKGxldCBpID0gMCwgbiA9IG5vZGVzLmxlbmd0aDsgaSA8IG47IGkrKykge1xuICAgICAgICBjb25zdCB7IHJvdywgY29sLCB2YWx1ZSB9ID0gbm9kZXNbaV07XG4gICAgICAgIGNvbnN0IHAgPSAocm93ICsgZHkpICogdyArIChjb2wgKyBkeCkgKiA0O1xuXG4gICAgICAgIHN3aXRjaCAodmFsdWUpIHtcbiAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAvLyBDbG9zZWQgbm9kZVxuICAgICAgICAgICAgICAgIGRhdGFbcF0gPSAyNTU7XG4gICAgICAgICAgICAgICAgLy8gZGF0YVtwICsgMV0gPSAwO1xuICAgICAgICAgICAgICAgIC8vIGRhdGFbcCArIDJdID0gMDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAvLyBQYXRoIG5vZGVcbiAgICAgICAgICAgICAgICAvLyBkYXRhW3BdID0gMDtcbiAgICAgICAgICAgICAgICBkYXRhW3AgKyAxXSA9IDI1NTtcbiAgICAgICAgICAgICAgICAvLyBkYXRhW3AgKyAyXSA9IDA7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICBkYXRhW3AgKyAzXSA9IDI1NTtcbiAgICB9XG4gICAgcGxheWVyUGF0aENhbnZhcy5wdXRJbWFnZURhdGEocGxheWVyUGF0aEltYWdlRGF0YSwgMCwgMCk7XG4gICAgcmVzZXRDaGFuZ2VzKCk7XG59XG4iLCJpbXBvcnQgUmF5IGZyb20gJy4vcmF5JztcbmltcG9ydCB7IGdvYWwgfSBmcm9tICcuLi9zdG9yZSc7XG5pbXBvcnQgKiBhcyBwYXRoZmluZGVyIGZyb20gJy4uL3BhdGhmaW5kZXIvYS1zdGFyJztcbmltcG9ydCB7IGNvcywgZGlyLCBNZW1vcnlDaGFuZ2VMaXN0LCByYW5kSW50LCBzaW4sIHNsZWVwIH0gZnJvbSAnLi4vdXRpbCc7XG5pbXBvcnQgeyBkcmF3UGxheWVyUGF0aCwgcmVzZXRQbGF5ZXJQYXRoIH0gZnJvbSAnLi4vZHJhdyc7XG5cbmNsYXNzIFBsYXllciB7XG4gICAgLy8gTWVtb3J5IGxheWVyXG4gICAgbWVtb3J5OiBNZW1vcnlDaGFuZ2VMaXN0ID0gbmV3IE1lbW9yeUNoYW5nZUxpc3QoKTtcblxuICAgIC8vIE1hcCBsYXllclxuICAgIHg6IG51bWJlcjtcbiAgICB5OiBudW1iZXI7XG4gICAgZGlyID0gMDtcbiAgICByYXlzOiBSYXlbXSA9IFtdO1xuICAgIHBhdGg6IHsgeDogbnVtYmVyOyB5OiBudW1iZXIgfVtdID0gW107XG4gICAgZ29hbD86IHsgeDogbnVtYmVyOyB5OiBudW1iZXIgfTtcbiAgICBwYXRoZmluZGVyOiB7XG4gICAgICAgIGluaXQocGxheWVyOiBQbGF5ZXIsIGVuZDogeyB4OiBudW1iZXI7IHk6IG51bWJlciB9KTogdm9pZDtcbiAgICAgICAgY29tcHV0ZSgpOiB7IHg6IG51bWJlcjsgeTogbnVtYmVyIH1bXSB8IHVuZGVmaW5lZDtcbiAgICB9O1xuICAgIGdvYWxEaXJlY3Rpb25zOiB7IHg6IG51bWJlcjsgeTogbnVtYmVyOyBkaXI6IG51bWJlciB9W10gPSBbXTtcblxuICAgIGNvbnN0cnVjdG9yKHggPSAwLCB5ID0gMCwgbiA9IDM2MCkge1xuICAgICAgICB0aGlzLnggPSB4O1xuICAgICAgICB0aGlzLnkgPSB5O1xuICAgICAgICB0aGlzLnBhdGhmaW5kZXIgPSBwYXRoZmluZGVyO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDM2MDsgaSArPSAzNjAgLyBuKSB0aGlzLnJheXMucHVzaChuZXcgUmF5KGksIDUwKSk7XG4gICAgfVxuXG4gICAgZmluZEdvYWwoc3g6IG51bWJlciwgc3k6IG51bWJlcik6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5nb2FsRGlyZWN0aW9ucy5sZW5ndGggPiAxMCkge1xuICAgICAgICAgICAgY29uc3QgeCA9IDEwMDtcbiAgICAgICAgICAgIGNvbnN0IHkgPSAwO1xuXG4gICAgICAgICAgICBmb3IgKGNvbnN0IHsgeDogbDF4MSwgeTogbDF5MSwgZGlyOiBsMWRpciB9IG9mIHRoaXMuZ29hbERpcmVjdGlvbnMpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBsMXgyID0gbDF4MSArIE1hdGgucm91bmQoeCAqIGNvcyhsMWRpcikgLSB5ICogc2luKGwxZGlyKSk7XG4gICAgICAgICAgICAgICAgY29uc3QgbDF5MiA9IGwxeTEgKyBNYXRoLnJvdW5kKHggKiBzaW4obDFkaXIpICsgeSAqIGNvcyhsMWRpcikpO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgYTEgPSBsMXkyIC0gbDF5MTtcbiAgICAgICAgICAgICAgICBjb25zdCBiMSA9IGwxeDEgLSBsMXgyO1xuICAgICAgICAgICAgICAgIGNvbnN0IGMxID0gYTEgKiBsMXgxICsgYjEgKiBsMXkxO1xuXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCB7IHg6IGwyeDEsIHk6IGwyeTEsIGRpcjogbDJkaXIgfSBvZiB0aGlzLmdvYWxEaXJlY3Rpb25zKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGwyeDIgPSBsMngxICsgTWF0aC5yb3VuZCh4ICogY29zKGwyZGlyKSAtIHkgKiBzaW4obDJkaXIpKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbDJ5MiA9IGwyeTEgKyBNYXRoLnJvdW5kKHggKiBzaW4obDJkaXIpICsgeSAqIGNvcyhsMmRpcikpO1xuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGEyID0gbDJ5MiAtIGwyeTE7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGIyID0gbDJ4MSAtIGwyeDI7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGMyID0gYTIgKiBsMngxICsgYjIgKiBsMnkxO1xuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGQgPSBhMSAqIGIyIC0gYTIgKiBiMTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBQYXJhbGxlbFxuICAgICAgICAgICAgICAgICAgICBpZiAoZCA9PT0gMCkgY29udGludWU7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5nb2FsID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgeDogTWF0aC5yb3VuZCgoYjIgKiBjMSAtIGIxICogYzIpIC8gZCksXG4gICAgICAgICAgICAgICAgICAgICAgICB5OiBNYXRoLnJvdW5kKChhMSAqIGMyIC0gYTIgKiBjMSkgLyBkKSxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHsgeCwgeSwgZGlyIH0gPSB0aGlzO1xuICAgICAgICB0aGlzLmdvYWxEaXJlY3Rpb25zLnB1c2goeyB4OiB4ICsgc3gsIHk6IHkgKyBzeSwgZGlyIH0pO1xuICAgICAgICB0aGlzLnBhdGgucHVzaCh7IHg6IHggKyByYW5kSW50KC0xLCAxKSwgeTogeSArIHJhbmRJbnQoLTEsIDEpIH0pO1xuICAgIH1cblxuICAgIGFzeW5jIHVwZGF0ZShzeDogbnVtYmVyLCBzeTogbnVtYmVyKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIC8vIFVwZGF0ZSBnb2FsIGRpcmVjdGlvblxuICAgICAgICB0aGlzLmRpciA9IGRpcih0aGlzLnggKyBzeCwgdGhpcy55ICsgc3ksIGdvYWwueCwgZ29hbC55KTtcblxuICAgICAgICBpZiAodGhpcy54ICsgc3ggPT09IHRoaXMuZ29hbD8ueCAmJiB0aGlzLnkgKyBzeSA9PT0gdGhpcy5nb2FsPy55KSB7XG4gICAgICAgICAgICB0aGlzLmdvYWwgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB0aGlzLmdvYWxEaXJlY3Rpb25zID0gW107XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIXRoaXMuZ29hbCkgdGhpcy5maW5kR29hbChzeCwgc3kpO1xuXG4gICAgICAgIGlmICh0aGlzLmdvYWwgJiYgdGhpcy5wYXRoLmxlbmd0aCA9PT0gMCkgYXdhaXQgdGhpcy5jb21wdXRlUGF0aChzeCwgc3kpO1xuXG4gICAgICAgIGNvbnN0IHsgeCwgeSB9ID0gdGhpcy5wYXRoLnBvcCgpITtcblxuICAgICAgICBjb25zdCBvYnN0YWNsZXM6IHsgeDogbnVtYmVyOyB5OiBudW1iZXIgfVtdID0gW107XG5cbiAgICAgICAgY29uc3QgeyByYXlzLCBtZW1vcnkgfSA9IHRoaXM7XG5cbiAgICAgICAgLy8gQ2FzdCBsaWRhclxuICAgICAgICBmb3IgKGxldCBpID0gMCwgbiA9IHJheXMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCByYXkgPSByYXlzW2ldO1xuICAgICAgICAgICAgY29uc3QgW2NvbGxpZGUsIHBvaW50LCBnb2FsXSA9IHJheS51cGRhdGUoeCArIHN4LCB5ICsgc3kpO1xuXG4gICAgICAgICAgICAvLyBTZXQgZ29hbCBpZiBmb3VuZFxuICAgICAgICAgICAgaWYgKGdvYWwpIHtcbiAgICAgICAgICAgICAgICAvLyBVcGRhdGUgZ29hbCBlc3RpbWF0ZSB0byBhY3R1YWwgcG9zaXRpb25cbiAgICAgICAgICAgICAgICB0aGlzLmdvYWwgPSBnb2FsO1xuICAgICAgICAgICAgICAgIG1lbW9yeS5zZXQoZ29hbC55IC0gc3ksIGdvYWwueCAtIHN4LCAzKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gVW5kbyBtb3ZlbWVudCBpZiBpdCB3aWxsIHJlc3VsdCBpbiBjb2xsaXNpb25cbiAgICAgICAgICAgIGlmIChjb2xsaWRlKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBkaXIgfSA9IHJheTtcbiAgICAgICAgICAgICAgICBjb25zdCBkeCA9IE1hdGgucm91bmQoY29zKGRpcikgLSBzaW4oZGlyKSk7XG4gICAgICAgICAgICAgICAgY29uc3QgZHkgPSBNYXRoLnJvdW5kKHNpbihkaXIpICsgY29zKGRpcikpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5wYXRoID0gW3sgeDogdGhpcy54IC0gMyAqIGR4LCB5OiB0aGlzLnkgLSAzICogZHkgfV07XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy51cGRhdGUoc3gsIHN5KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQWRkIGRldGVjdGVkIHBvaW50XG4gICAgICAgICAgICBpZiAocG9pbnQpIG9ic3RhY2xlcy5wdXNoKHBvaW50KTtcbiAgICAgICAgfVxuXG4gICAgICAgIG1lbW9yeS5yZXNldCgpO1xuXG4gICAgICAgIC8vIFNldCBkZXRlY3RlZCBwb2ludHMgaW4gbWVtb3J5IGFzIGRpc2NvdmVyZWQgb2JzdGFjbGVzXG4gICAgICAgIGZvciAobGV0IGkgPSAwLCBuID0gb2JzdGFjbGVzLmxlbmd0aDsgaSA8IG47IGkrKykge1xuICAgICAgICAgICAgY29uc3QgeyB4LCB5IH0gPSBvYnN0YWNsZXNbaV07XG4gICAgICAgICAgICBpZiAobWVtb3J5LmdldCh5IC0gc3ksIHggLSBzeCkgIT09IDIpIG1lbW9yeS5zZXQoeSAtIHN5LCB4IC0gc3gsIDIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gU2V0IGludGVncmFscyB3aXRoIG5vIGRldGVjdGlvbiBpbiBtZW1vcnkgYXMgZGlzY292ZXJlZCBmcmVlIHBvaW50c1xuICAgICAgICBmb3IgKGxldCBpID0gMCwgbiA9IHJheXMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCB7IGludGVncmFscyB9ID0gcmF5c1tpXTtcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAwLCBuID0gaW50ZWdyYWxzLmxlbmd0aDsgaiA8IG47IGorKykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHsgeCwgeSB9ID0gaW50ZWdyYWxzW2pdO1xuICAgICAgICAgICAgICAgIGlmIChtZW1vcnkuZ2V0KHkgLSBzeSwgeCAtIHN4KSAhPT0gMSkgbWVtb3J5LnNldCh5IC0gc3ksIHggLSBzeCwgMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnggPSB4O1xuICAgICAgICB0aGlzLnkgPSB5O1xuXG4gICAgICAgIC8vIGNvbnN0IHsgeCA9IHRoaXMueCwgeSA9IHRoaXMueSB9ID0gcGF0aEZpbmRlci51cGRhdGUoKTtcbiAgICAgICAgLy8gdGhpcy5keCA9IE1hdGgucm91bmQoKHggLSB0aGlzLngpICogY29zKHRoaXMuZGlyKSAtICh5IC0gdGhpcy55KSAqIHNpbih0aGlzLmRpcikpO1xuICAgICAgICAvLyB0aGlzLmR5ID0gTWF0aC5yb3VuZCgoeCAtIHRoaXMueCkgKiBzaW4odGhpcy5kaXIpICsgKHkgLSB0aGlzLnkpICogY29zKHRoaXMuZGlyKSk7XG4gICAgfVxuXG4gICAgYXN5bmMgY29tcHV0ZVBhdGgoc3g6IG51bWJlciwgc3k6IG51bWJlcik6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBjb25zdCB7IHBhdGgsIGdvYWwsIHBhdGhmaW5kZXIgfSA9IHRoaXM7XG5cbiAgICAgICAgLy8gUmVjb21wdXRlIHBhdGggaWYgZ29hbCBpcyBmb3VuZCBhbmQgcGF0aCBpcyBub3QgaW5pdGlhbGlzZWQgb3IgcHJvYmxlbWF0aWNcbiAgICAgICAgaWYgKHBhdGgubGVuZ3RoID09PSAwICYmIGdvYWwpIHtcblxuICAgICAgICAgICAgcGF0aGZpbmRlci5pbml0KHRoaXMsIHsgeDogZ29hbC54IC0gc3gsIHk6IGdvYWwueSAtIHN5IH0pO1xuICAgICAgICAgICAgcmVzZXRQbGF5ZXJQYXRoKCk7XG4gICAgICAgICAgICBsZXQgcGF0aDtcbiAgICAgICAgICAgIHdoaWxlICghcGF0aCkge1xuICAgICAgICAgICAgICAgIHBhdGggPSBwYXRoZmluZGVyLmNvbXB1dGUoKTtcbiAgICAgICAgICAgICAgICBkcmF3UGxheWVyUGF0aCgpO1xuICAgICAgICAgICAgICAgIGF3YWl0IHNsZWVwKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnBhdGggPSBwYXRoO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5jb25zdCBwbGF5ZXIgPSBuZXcgUGxheWVyKCk7XG5cbmV4cG9ydCBkZWZhdWx0IHBsYXllcjtcblxuZXhwb3J0IHtQbGF5ZXJ9O1xuIiwiaW1wb3J0IHsgVGltZXIgfSBmcm9tICcuL3V0aWwnO1xuaW1wb3J0IHBsYXllciBmcm9tICcuL3BsYXllcic7XG5pbXBvcnQge1xuICAgIGdvYWwsXG4gICAgaGVpZ2h0LFxuICAgIGtleWJvYXJkLFxuICAgIG1hcEJhY2tncm91bmRDYW52YXMsXG4gICAgbWF6ZSxcbiAgICBvYnN0YWNsZXMsXG4gICAgc3RhcnQsXG4gICAgd2lkdGgsXG59IGZyb20gJy4vc3RvcmUnO1xuaW1wb3J0IG1hcCBmcm9tICcuL21hcCc7XG5cbmltcG9ydCB7IGRyYXdNYXAsIGRyYXdQbGF5ZXIgfSBmcm9tICcuL2RyYXcnO1xuXG5jb25zdCB0aW1lciA9IG5ldyBUaW1lcigpO1xuXG5jb25zdCBmcHMgPSAxNDQ7XG5cbmNvbnN0IGRlbGF5ID0gMTAwMCAvIGZwcztcblxuY29uc3QgZnBzRGlzcGxheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmcHMnKSE7XG5jb25zdCBwb3NEaXNwbGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BsYXllci1wb3MnKSE7XG5jb25zdCBhY3R1YWxQb3NEaXNwbGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BsYXllci1hY3R1YWwtcG9zJykhO1xuY29uc3QgZ29hbEVzdGltYXRlRGlzcGxheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwbGF5ZXItZXN0aW1hdGUnKSE7XG5cbmxldCB0ID0gMDtcblxud2luZG93Lm9ubG9hZCA9IGFzeW5jIGZ1bmN0aW9uICgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zb2xlLmxvZygnTG9hZCBvaycpO1xuXG4gICAgbWFwQmFja2dyb3VuZENhbnZhcy5kcmF3SW1hZ2UobWF6ZSwgMCwgMCk7XG5cbiAgICAvLyBTZXQgc3RhdGljIG9ic3RhY2xlc1xuICAgIG1hcC5zZXQobWFwQmFja2dyb3VuZENhbnZhcy5nZXRJbWFnZURhdGEoMCwgMCwgd2lkdGgsIGhlaWdodCkuZGF0YSk7XG5cbiAgICAvLyBEcmF3IGdvYWwgdG8gbWFwIGJhY2tncm91bmRcbiAgICBtYXBCYWNrZ3JvdW5kQ2FudmFzLmZpbGxTdHlsZSA9ICcjMDAwMEZGJztcbiAgICBtYXBCYWNrZ3JvdW5kQ2FudmFzLmJlZ2luUGF0aCgpO1xuICAgIG1hcEJhY2tncm91bmRDYW52YXMuYXJjKGdvYWwueCwgZ29hbC55LCAyLCAwLCAyICogTWF0aC5QSSk7XG4gICAgbWFwQmFja2dyb3VuZENhbnZhcy5maWxsKCk7XG5cbiAgICBtYXAucmVzZXQoKTtcbiAgICBjb25zb2xlLmxvZygnc3RhcnRpbmcuLi4nKTtcblxuICAgIGluaXQoKTtcbn07XG5cbmFzeW5jIGZ1bmN0aW9uIHVwZGF0ZSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0aW1lci5zdGFydCgpO1xuXG4gICAgb2JzdGFjbGVzLnVwZGF0ZSgpO1xuXG4gICAgbWFwLnJlc2V0KCk7XG5cbiAgICAvLyBjb25zdCBkeSA9IChrZXlib2FyZC5zID8gLTEgOiAwKSArIChrZXlib2FyZC53ID8gMSA6IDApO1xuICAgIC8vIGNvbnN0IGR4ID0gKGtleWJvYXJkLmQgPyAtMSA6IDApICsgKGtleWJvYXJkLmEgPyAxIDogMCk7XG5cbiAgICBhd2FpdCBwbGF5ZXIudXBkYXRlKHN0YXJ0LngsIHN0YXJ0LnkpO1xuXG4gICAgZHJhdyh1cGRhdGUpO1xufVxuXG5mdW5jdGlvbiBkcmF3KG5leHQ6ICgpID0+IHZvaWQpOiB2b2lkIHtcbiAgICBkcmF3TWFwKCk7XG5cbiAgICBkcmF3UGxheWVyKCk7XG5cbiAgICBwb3NEaXNwbGF5LmlubmVyVGV4dCA9IGBtZW1vcnkgeDogJHtwbGF5ZXIueH0sIHk6ICR7cGxheWVyLnl9YDtcblxuICAgIGdvYWxFc3RpbWF0ZURpc3BsYXkuaW5uZXJUZXh0ID0gcGxheWVyLmdvYWwgPyBgeDogJHtwbGF5ZXIuZ29hbC54fSwgeTogJHtwbGF5ZXIuZ29hbC55fWAgOiAnc2VhcmNoaW5nJztcblxuICAgIGFjdHVhbFBvc0Rpc3BsYXkuaW5uZXJUZXh0ID0gYGFjdHVhbCB4OiAke3BsYXllci54ICsgc3RhcnQueH0sIHk6ICR7cGxheWVyLnkgKyBzdGFydC55fWA7XG5cbiAgICB0ID0gdGltZXIuZW5kKCk7XG5cbiAgICBzZXRUaW1lb3V0KG5leHQsIGRlbGF5IC0gdCk7IC8vIGZpeG1lIGxvb3Bcbn1cblxuLy8gRlBTXG4vLyBzZXRJbnRlcnZhbCgoKSA9PiAoZnBzRGlzcGxheS5pbm5lclRleHQgPSB0ICsgJyBtcyBwZXIgY3ljbGUnKSwgMTAwKTtcbnNldEludGVydmFsKCgpID0+IChmcHNEaXNwbGF5LmlubmVyVGV4dCA9ICdmcHMgJyArIE1hdGguZmxvb3IoMTAwMCAvIHQpKSwgMTAwKTtcblxubGV0IGJlZ2luID0gZmFsc2U7XG5cbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCAoeyBrZXkgfSkgPT4ge1xuICAgIGlmIChrZXkgPT09ICcgJyAmJiAhYmVnaW4pIGJlZ2luID0gdHJ1ZTtcbn0pO1xuXG5mdW5jdGlvbiBpbml0KCk6IHZvaWQge1xuICAgIGNvbnN0IGR5ID0gKGtleWJvYXJkLnMgPyAtMSA6IDApICsgKGtleWJvYXJkLncgPyAxIDogMCk7XG4gICAgY29uc3QgZHggPSAoa2V5Ym9hcmQuZCA/IC0xIDogMCkgKyAoa2V5Ym9hcmQuYSA/IDEgOiAwKTtcblxuICAgIC8vIHBsYXllci54ICs9IGR4O1xuICAgIC8vIHBsYXllci55ICs9IGR5O1xuICAgIHN0YXJ0LnggKz0gZHg7XG4gICAgc3RhcnQueSArPSBkeTtcblxuICAgIGlmIChiZWdpbikgZHJhdyh1cGRhdGUpO1xuICAgIGVsc2UgZHJhdyhpbml0KTtcbn1cbiIsImltcG9ydCBwbGF5ZXIgZnJvbSAnLi4vcGxheWVyJztcbmltcG9ydCB7IGNvcywgc2luIH0gZnJvbSAnLi4vdXRpbCc7XG5pbXBvcnQgeyBoZWlnaHQsIG1hcE1haW5DYW52YXMsIG9ic3RhY2xlcywgd2lkdGgsIHN0YXJ0IH0gZnJvbSAnLi4vc3RvcmUnO1xuXG5leHBvcnQgZnVuY3Rpb24gZHJhd01hcCgpOiB2b2lkIHtcbiAgICBtYXBNYWluQ2FudmFzLmNsZWFyUmVjdCgwLCAwLCB3aWR0aCwgaGVpZ2h0KTtcblxuICAgIC8vIERyYXcgcmF5c1xuICAgIG1hcE1haW5DYW52YXMuc3Ryb2tlU3R5bGUgPSAnI0NEQ0RDRCc7XG5cbiAgICBjb25zdCB7IHJheXMsIGRpciB9ID0gcGxheWVyO1xuICAgIGZvciAobGV0IHIgPSAwLCBuID0gcmF5cy5sZW5ndGg7IHIgPCBuOyByKyspIHtcbiAgICAgICAgY29uc3QgaW50ID0gcmF5c1tyXS5pbnRlZ3JhbHM7XG5cbiAgICAgICAgaWYgKGludFswXSkge1xuICAgICAgICAgICAgbWFwTWFpbkNhbnZhcy5iZWdpblBhdGgoKTtcbiAgICAgICAgICAgIG1hcE1haW5DYW52YXMubW92ZVRvKGludFswXS54LCBpbnRbMF0ueSk7XG4gICAgICAgICAgICBtYXBNYWluQ2FudmFzLmxpbmVUbyhpbnRbaW50Lmxlbmd0aCAtIDFdLngsIGludFtpbnQubGVuZ3RoIC0gMV0ueSk7XG4gICAgICAgICAgICBtYXBNYWluQ2FudmFzLnN0cm9rZSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgbWFwTWFpbkNhbnZhcy5maWxsU3R5bGUgPSAnIzAwMDAwMCc7XG4gICAgb2JzdGFjbGVzLmZvckVhY2goKHsgeCwgeSB9KSA9PiB7XG4gICAgICAgIG1hcE1haW5DYW52YXMuZmlsbFJlY3QoeCwgeSwgMSwgMSk7XG4gICAgICAgIG1hcE1haW5DYW52YXMuZmlsbCgpO1xuICAgIH0pO1xuXG4gICAgY29uc3Qgc3ggPSBwbGF5ZXIueCArIHN0YXJ0Lng7XG4gICAgY29uc3Qgc3kgPSBwbGF5ZXIueSArIHN0YXJ0Lnk7XG5cbiAgICAvLyAvLyBEcmF3IGRpcmVjdGlvbiBvZiBnb2FsXG4gICAgLy8gbWFwTWFpbkNhbnZhcy5zdHJva2VTdHlsZSA9ICcjMDAwMEZGJztcbiAgICAvLyBtYXBNYWluQ2FudmFzLmJlZ2luUGF0aCgpO1xuICAgIC8vXG5cbiAgICAvL1xuICAgIC8vIGNvbnN0IHggPSAxMDA7XG4gICAgLy8gY29uc3QgeSA9IDA7XG4gICAgLy9cbiAgICAvLyBtYXBNYWluQ2FudmFzLm1vdmVUbyhzeCwgc3kpO1xuICAgIC8vIG1hcE1haW5DYW52YXMubGluZVRvKFxuICAgIC8vICAgICBzeCArIE1hdGgucm91bmQoeCAqIGNvcyhkaXIpIC0geSAqIHNpbihkaXIpKSxcbiAgICAvLyAgICAgc3kgKyBNYXRoLnJvdW5kKHggKiBzaW4oZGlyKSArIHkgKiBjb3MoZGlyKSlcbiAgICAvLyApO1xuICAgIC8vIG1hcE1haW5DYW52YXMuc3Ryb2tlKCk7XG5cbiAgICAvLyBEcmF3IHBsYXllclxuICAgIG1hcE1haW5DYW52YXMuZmlsbFN0eWxlID0gJyNGRjAwMDAnO1xuICAgIG1hcE1haW5DYW52YXMuYmVnaW5QYXRoKCk7XG4gICAgbWFwTWFpbkNhbnZhcy5hcmMoc3gsIHN5LCAyLCAwLCAyICogTWF0aC5QSSk7XG4gICAgbWFwTWFpbkNhbnZhcy5maWxsKCk7XG59XG4iXSwic291cmNlUm9vdCI6IiJ9